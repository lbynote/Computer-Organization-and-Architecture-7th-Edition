# 3.1 计算机的部件

冯·诺依曼结构基于以下3个关键性的概念：
1. 数据和指令存储在单一的“读写存储器”中。
2. 存储器的内容通过位置寻址，而不考虑它容纳的数据是什么。
3. 以顺序的形式从一条指令到下一条指令来（除非有明确的修改）执行。

为了和内存交换数据，CPU一般使用两个内部寄存器：
1. 存储地址寄存器（MAR），为下一次读或者写指定内存地址。
2. 存储缓冲寄存器（MBR），容纳写到内存或从内存接收的数据。
类似地，一个I/O地址寄存器（I/O AR）指定了一个特定的I/O设备；I/O缓冲寄存器（I/O BR）用于I/O模块和CPU的数据交换。

内存模块包含一组单元，有连续的编号来定义其地址。每个单元都含有一个二进制数，它既可以解释为指令也可解释为数据。

I/O模块将数据从外设传送到CPU或存储器，反之亦然。I/O模块包含内部缓冲器，用来暂时存储I/O数据，知道它们被发送出去。

# 3.2 计算机功能

一条指令所要求的处理过程称为指令周期。指令周期又分为取值周期和执行周期。

## 3.2.1 指令的取和执行

每条指令周期开始时，CPU都从存储器中取指令。在典型的CPU中，用一个称为程序计数器(PC)的寄存器来保存待取指令的地址。除非特别指明，否则CPU在每次取指令之后总是将PC的值加上一个增量，以便顺序地取出下一条指令（也就是内存中下一条更高地址的指令）。

读取的指令装入CPU中的指令寄存器(IR)。指令以二进制代码的形式存在，它规定了CPU将要执行的动作。CPU解释这条指令并完成所要求的操作。总的来说，这些操作归为4类：
1. CPU-存储器：数据可从CPU传送到存储器或从存储器传送到CPU。
2. CPU-I/O：通过CPU和I/O模块之间的传输，数据可传送到或来自外部设备。
3. 数据处理：CPU可执行对数据的一些算术或逻辑操作。
4. 控制：指令可用来指定改变执行顺序。

基本指令周期中的状态描述：
1. 指令地址计算(instruction address calculate, iac)：决定下一条要执行指令的地址。
2. 读取指令(instruction fetch, if)：将指令从内存单元读到CPU中。
3. 指令操作译码(instruction operate decode, iod)：分析指令，以决定执行何种操作以及所用的操作数。
4. 操作数地址计算(operand address calculate, oac):如果操作包含对存储器或通过I/O的操作数的访问，那么必须决定操作数的地址。
5. 取操作数(operand fetch, of)：从存储器或从I/O中读取操作数。
6. 数据操作(data operate, do)：完成指令所给出的操作。
7. 存储操作数(operand storage, os)：将结果写入存储器或输出到I/O。

## 3.2.2 中断

中断的分类：

| 中断类型 | 产生的原因 |
| :- | :- |
| 程序 | 由指令执行结果伴随而出现的某些条件所产生。例如，算术溢出、除以零、企图执行一些非法的及其指令以及访问的地址超出了用户存储器空间。 |
| 定时器 | 由处理器中的定时器产生，它允许操作系统以规整的时间间隔执行特定的功能。 |
| I/O | 由/O控制器产生，以通知操作正常完成或各种出错情况。 |
| 硬件故障 | 如电源故障或存储器奇偶校检差错这类的故障产生。 |

### 3.2.2.1 中断和指令周期

如果出现中断请求，则处理器执行如下操作：
1. 挂起当前正在执行的程序，并保存状态。这意味着保存下一条即将执行的指令的地址（程序计数器PC的当前内容）和任何与处理器当前活动相关联的数据。
2. 将程序计数器(PC)设置为中断处理例程的起始地址。

### 3.2.2.2 多重中断

处理多重中断有两种方法：
1. 顺序处理中断：在中断处理过程中禁止其他中断。这种方法的缺点是没有考虑相对的优先级和时间的紧迫。
2. 嵌套中断处理：定义中断的优先级，且允许优先级高的中断引起低级中断处理例程本身被中断。

## 3.2.3 I/O功能

I/O模块能与CPU直接交换数据。  
某些情况下，需要I/O直接同内存交换数据。这种情况下，CPU授予I/O模块读/写存储器的权利，这样，I/O和存储器的传输就不需要CPU的介入。这种操作称为直接存储器访问(DMA)。

# 3.3 互连结构

连接各种模块的通路的集合称为互连结构(interconnection structure)。

# 3.4 总线互连

总线(bus)是连接两个或多个设备的通信通路。总线的关键特征是共享传输介质。多种设备连接到总线上，一个设备发出的信号可以被其他所有连接到总线上的设备所接收。如果两个设备同时发送，它们的信号将会重叠，这样会引起混淆。因此，每次只有一个设备成功地利用总线发送数。  
多数情况下，总线由多条通信路径或线路组成，每条线能够传送代表二进制1和0的信号。  
连接计算机主要部件（处理器、存储器、I/O）的总线称为系统总线。最常见的计算机互连结构使用一个或多个系统总线。

## 3.4.1 总线结构

任何总线的线路都可以分成如下3个功能组：**数据总线、地址总线和控制总线**。此外，还有为连接的模块提供电源的电源馈线。

数据线提供系统模块间传送数据的路径，这些线组合在一起称为数据总线。典型的数据总线包含8、16或32根线，这些线的数目为数据总线的宽度。

地址线用于指定数据总线上数据的来源或去向。显然，地址总线的宽度决定了系统能够使用的最大的存储器容量。而且地址线通常也用于I/O端口的寻址。在实际应用中，地址线的高位用于选择总线上指定的模块（区域），地位用于选择模块内具体的存储器单元或I/O端口。

控制线用来控制对数据地址线的存取和使用。控制信号在系统模块之前发送命令和时序信号。时序信号指定了数据和地址信息的有效性，命令信号指定了要执行的操作。